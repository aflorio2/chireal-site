# GitLab CI/CD configuration for Greene Lab Jekyll site
# Manual Local Manubot approach - Manubot runs locally, not in CI

image: ruby:3.3

# Cache gems to speed up builds
cache:
  paths:
    - vendor/bundle

# Install Jekyll dependencies before building
before_script:
  - gem install bundler
  - bundle install --path vendor/bundle --jobs $(nproc)

# Pages job - builds and deploys the site
pages:
  stage: deploy
  script:
    # Build Jekyll site to public/ directory
    - bundle exec jekyll build -d public

    # Show build info
    - echo "Site built successfully to public/"
    - ls -lh public/ | head -20

  artifacts:
    paths:
      - public

  rules:
    # Only deploy on main branch
    - if: $CI_COMMIT_BRANCH == "main"

  environment: production
